<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organic Map Pro</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { margin: 0; font-family: sans-serif; }
        #map { height: 100vh; width: 100vw; }
        .ui-panel {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            z-index: 1000; width: 85%; max-width: 400px;
        }
        #scan-btn {
            background: #2e7d32; color: white; border: none; padding: 20px;
            width: 100%; border-radius: 50px; font-weight: bold; font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer;
        }
        #scan-btn:active { background: #1b5e20; transform: scale(0.98); }
        #status {
            text-align: center; margin-top: 10px; background: white;
            padding: 5px; border-radius: 10px; font-size: 0.8rem; opacity: 0.9;
        }
    </style>
</head>
<body>

<div id="map"></div>
<div class="ui-panel">
    <button id="scan-btn" onclick="searchOrganic()">ğŸŒ¿ å‘¨è¾ºã®ã‚·ãƒ§ãƒƒãƒ—ã‚’ã‚¹ã‚­ãƒ£ãƒ³</button>
    <div id="status">æº–å‚™å®Œäº†</div>
</div>

<script>
    const map = L.map('map').setView([35.68, 139.76], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    function searchOrganic() {
        const status = document.getElementById('status');
        status.innerText = "ç¾åœ¨åœ°ã‚’ç‰¹å®šä¸­...";

        navigator.geolocation.getCurrentPosition(pos => {
            const { latitude: lat, longitude: lon } = pos.coords;
            map.setView([lat, lon], 14);
            L.marker([lat, lon]).addTo(map).bindPopup("ç¾åœ¨åœ°").openPopup();

            status.innerText = "å…¨å›½ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ¤œç´¢ä¸­...";

            // ã€ãƒã‚¤ãƒ³ãƒˆã€‘æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’åºƒã’ã¾ã—ãŸï¼šæœ‰æ©Ÿã€å¥åº·é£Ÿå“ã€ç”£ç›´ã€ãƒ™ã‚¸ã‚¿ãƒªã‚¢ãƒ³
            const query = `[out:json];
                (
                  node["shop"~"organic|health_food|nature"](around:5000,${lat},${lon});
                  node["name"~"æœ‰æ©Ÿ|è‡ªç„¶é£Ÿå“|ç”£ç›´|ã‚ªãƒ¼ã‚¬ãƒ‹ãƒƒã‚¯"](around:5000,${lat},${lon});
                );
                out;`;
            
            fetch(`https://overpass-api.de/api/interpreter?data=${encodeURIComponent(query)}`)
            .then(res => res.json())
            .then(data => {
                if (data.elements.length === 0) {
                    status.innerText = "ä»˜è¿‘ã«è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ç¯„å›²ã‚’åºƒã’ã¦ã¿ã¦ãã ã•ã„ã€‚";
                    return;
                }
                status.innerText = `${data.elements.length}ä»¶è¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼`;
                
                data.elements.forEach(el => {
                    const name = el.tags.name || "è‡ªç„¶é£Ÿå“åº—";
                    const greenIcon = L.icon({
                        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
                        iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34]
                    });

                    L.marker([el.lat, el.lon], {icon: greenIcon}).addTo(map)
                        .bindPopup(`<b>${name}</b><br><br><a href="https://www.google.com/maps/search/?api=1&query=${el.lat},${el.lon}" target="_blank" style="background:#f39c12;color:white;padding:5px 10px;text-decoration:none;border-radius:3px;">Googleãƒãƒƒãƒ—ã‚’é–‹ã</a>`);
                });
            })
            .catch(() => status.innerText = "é€šä¿¡ã‚¨ãƒ©ãƒ¼ã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
        });
    }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organic Finder</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        header { background: #1b5e20; color: white; padding: 15px; text-align: center; font-size: 1.2rem; }
        #map { flex-grow: 1; width: 100%; height: 50vh; }
        .ui-area { padding: 20px; background: white; text-align: center; }
        button { background: #f39c12; color: white; border: none; padding: 15px 30px; border-radius: 5px; font-weight: bold; font-size: 1.1rem; cursor: pointer; width: 100%; max-width: 300px; }
        #debug-msg { color: #d32f2f; font-size: 0.8rem; margin-top: 10px; border: 1px solid #eee; padding: 5px; }
    </style>
</head>
<body>

<header>ğŸŒ¿ Organic Finder</header>
<div id="map"></div>
<div class="ui-area">
    <button onclick="updateLocation()">ğŸ“ ç¾åœ¨åœ°å‘¨è¾ºã‚’ã‚¹ã‚­ãƒ£ãƒ³</button>
    <div id="debug-msg">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: å¾…æ©Ÿä¸­</div>
</div>

<script>
    const map = L.map('map').setView([35.0, 135.0], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    function updateLocation() {
        const debug = document.getElementById('debug-msg');
        debug.innerText = "GPSèµ·å‹•ä¸­...";

        if (!navigator.geolocation) {
            debug.innerText = "ã‚¨ãƒ©ãƒ¼: ãŠä½¿ã„ã®ç«¯æœ«ãŒGPSã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚";
            return;
        }

        // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šã‚’è¿½åŠ ã—ã¦ã€åå¿œãŒãªã„çŠ¶æ…‹ã‚’é˜²ãã¾ã™
        const options = { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 };

        navigator.geolocation.getCurrentPosition(
            (pos) => {
                const { latitude, longitude } = pos.coords;
                debug.innerText = `æˆåŠŸ! ç·¯åº¦:${latitude.toFixed(3)} çµŒåº¦:${longitude.toFixed(3)}`;
                map.setView([latitude, longitude], 15);
                L.marker([latitude, longitude]).addTo(map).bindPopup("ã‚ãªãŸã®ç¾åœ¨åœ°").openPopup();
            },
            (err) => {
                debug.innerText = `ã‚¨ãƒ©ãƒ¼(${err.code}): ${err.message}`;
                if(err.code === 1) alert("ä½ç½®æƒ…å ±ã®ä½¿ç”¨ã‚’è¨±å¯ã—ã¦ãã ã•ã„");
            },
            options
        );
    }
</script>
</body>
</html>

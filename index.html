function updateLocation() {
        const debug = document.getElementById('debug-msg');
        debug.innerText = "現在地を特定中...";

        navigator.geolocation.getCurrentPosition((pos) => {
            const { latitude, longitude } = pos.coords;
            map.setView([latitude, longitude], 15);
            L.marker([latitude, longitude]).addTo(map).bindPopup("あなたの現在地").openPopup();
            
            // 【ここが魔法！】周辺のオーガニックに関連する場所を検索（OpenStreetMapのデータを使用）
            fetch(`https://overpass-api.de/api/interpreter?data=[out:json];node["shop"~"organic|health_food"](around:5000,${latitude},${longitude});out;`)
            .then(res => res.json())
            .then(data => {
                debug.innerText = `${data.elements.length}軒の店舗が見つかりました`;
                data.elements.forEach(item => {
                    L.marker([item.lat, item.lon], {icon: L.icon({
                        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
                        iconSize: [25, 41], iconAnchor: [12, 41]
                    })}).addTo(map).bindPopup(`<b>${item.tags.name || "有機製品取り扱い店"}</b><br><button onclick="window.open('https://www.google.com/maps/search/?api=1&query=${item.lat},${item.lon}')">ここへ行く(ナビ)</button>`);
                });
            });
        }, (err) => {
            debug.innerText = "GPSエラー: 許可設定を確認してください。";
        });
    }
